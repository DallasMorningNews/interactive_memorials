{"version":3,"sources":["+custom.js"],"names":["$","document","ready","switchFilterHed","click","text","this","val","hide","writeSubmissions","data","each","k","v","content","submissionTemplate","append","writeLocations","mobileContent","slideToggle","location","attr","filteringData","race","formatData","console","log","parks","currentSub","lat","long","races","raceKey","push","_","uniqBy","key","value","currentPark","currentRace","indexOf","createMap","map","on","e","features","queryRenderedFeatures","point","layers","getCanvas","style","cursor","GeoJSON","parse","Point","include","addSource","type","addLayer","id","source","paint","circle-radius","stops","circle-color","circleColor","circle-opacity","filteredData","submissionData","color","clearMap","html","length","displaySubmissions","removeSource","removeLayer","parkName","removeClass","addClass","enterSubmission","submission","post","fail","closeList","clickLocation","centerCoord","uniqArray","coord","popupContentCir","popupContentNoCir","geocoder","mapboxgl","Geocoder","container","stopPropagation","closest","siblings","find","hasClass","show","accessToken","Map","center","zoom","scrollZoom","disable","addControl","Navigation","Handlebars","compile","getJSON","trim","jQuery","changeShadows","scrollTop","innerHeight","scrollHeight","lngLat","lng","popup","feature","Popup","setLngLat","geometry","coordinates","setHTML","properties","addTo","flyTo","ev","result","subLong","subLat","subRace","index","valid","elem","colors","approved","firstName","lastName","email","why","learnMore","d","Date","year","getFullYear","$hedButton","cookie"],"mappings":"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","file":"scripts-bundle.js","sourcesContent":["$(document).ready(function() {\n\n\t//custom scripting goes here\n\n\t\tvar submissionData;\n\t\tvar filteredData = [];\n\t\tvar uniqArray = [];\n\t\tvar clickLocation;\n\t\tvar centerCoord;\n\t\tvar coord = [];\n\t\tvar popupContentCir = \"<p>Add a memorial suggestion here?</p><a class='yes-btn-cir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>\";\n\t\tvar popupContentNoCir = \"<p>Add a memorial suggestion here?</p><a class='yes-btn-nocir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>\";\n\t\tvar geocoder = new mapboxgl.Geocoder({\n\t\t\t    container: 'geocoder-container' // Optional. Specify a unique container for the control to be added to.\n\t\t\t});\n\t\tvar counter = 0;\n\t\tvar parks = [];\n\t\tvar race = \"all\";\n\t\tvar customStyles;\n\t\tvar circleColor = \"#8554bf\";\n\t\tvar location = \"all\";\n\t\tvar divHeight = 0;\n\n\t\t//dropmenu\n\t\t\t// Changes main dropmenu text to cliked li, hides map popup if filter li clicked\n\t\t\tfunction switchFilterHed() {\n\t\t\t\t$(\".drop-location ul.dropmenu li a\").click(function(){\n\t\t\t\t\t$(\".location-hed\").text($(this).text());\n\t\t\t\t\t$(\".location-hed:first-child\").val($(this).text());\n\t\t\t\t\t$('.mapboxgl-popup').hide();\n\t\t\t\t});\n\t\t\t\t$(\".drop-filter ul.dropmenu li a\").click(function(){\n\t\t\t\t\t$(\".filter-hed\").text($(this).text());\n\t\t\t\t\t$(\".filter-hed:first-child\").val($(this).text());\n\t\t\t\t\t$('.mapboxgl-popup').hide();\n\t\t\t\t});\n\t\t\t\t$('.filter-mob-expand li').click(function() {\n\t\t\t\t\t$('.mapboxgl-popup').hide();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Toggles one dropdown when the other opens or when clicked elsewhere on the screen\n\t\t   $('.filter').click(function(e) {\n\t\t\t\te.stopPropagation();\n\t\t\t\t$(this).closest('.filter').siblings('.filter').find('ul.dropmenu:visible').slideToggle();\n\t\t\t\t$(this).find('ul.dropmenu').slideToggle();\n\t\t   });\n\n\t\t   // Anything clicked in the document will hide the dropdown\n\t\t   $(document).click(function(){\n\t\t\t $('.drop-filter > ul.dropmenu').hide();\n\t  \t\t $('.drop-location > ul.dropmenu').hide();\n\t\t   });\n\n\t\t   // Shows/hides submission form and respective buttons\n\t\t\t   $(\".add-pin, .map-wrapper h1\").click(function() {\n\t\t\t\t   if ($('#form-wrapper').hasClass(\"visible\")) {\n\t\t\t\t\t   $('#form-wrapper').removeClass(\"visible\");\n\t\t\t\t   } else {\n\t\t\t\t\t   $('#form-wrapper').addClass(\"visible\");\n\t\t\t\t   }\n\t\t\t   });\n\n\t\t\t   $('.close, .modal-close').click(function() {\n\t\t\t\t   $('#form-wrapper').removeClass('visible');\n\t\t\t\t   $('.modal').hide();\n\t\t\t\t   $('.form-control').val('');\n\t\t\t\t   $('.form-group').show();\n\t\t\t\t   $('.form-horizontal h5').hide();\n\t\t\t   });\n\n\t\t\t   $('.add-pin, .map-wrapper').click(function() {\n\t\t\t\t   $('.modal').hide();\n\t\t\t\t   $('.form-control').val('');\n\t\t\t\t   $('.form-group').show();\n\t\t\t\t   $('.form-horizontal h5').hide();\n\t\t\t   });\n\n\t\t   // Getting the value of the filter drop\n\t\t\t   $('.drop-filter li, .filter-mob-race li').click(function() {\n\t\t\t\t   race = $(this).attr(\"data-race\");\n\t\t\t\t   filteringData(race, location);\n\t\t\t   });\n\n\t\tmapboxgl.accessToken = 'pk.eyJ1IjoibWFjbWFuIiwiYSI6ImVEbmNmZjAifQ.zVzy9cyjNT1tMYOTex51HQ';\n\n\t\t// BUILDING THE MAP\n\t\t\tvar map = new mapboxgl.Map({\n\t\t\t\tcontainer: 'map', // the #id of your map\n\t\t\t\tcenter: [-96.9785, 32.8924], // just like Leaflet, where the map should centers on load\n\t\t\t\tzoom: 9, // just like Leaflet, the map's default zoom level\n\t\t\t\tstyle:\n\t\t\t\t 'mapbox://styles/mapbox/basic-v9' // <= this tells Mapbox GL to use our vector tiles\n\t\t\t});\n\n\n\t\t// MAP CUSTOMIZATION\n\t\t\t// disables zoom\n\t\t\t\tmap.scrollZoom.disable();\n\t\t\t// add search bar\n\t\t\t\tmap.addControl(geocoder);\n\t\t\t// adds zoom options\n\t\t\t\tmap.addControl(new mapboxgl.Navigation());\n\t\t\t// adds cursor: pointer to map points\n\t\t\t\tmap.on('mousemove', function (e) {\n\t\t\t\t    var features = map.queryRenderedFeatures(e.point, { layers: ['memorialSubmissions'] });\n\t\t\t\t    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';\n\t\t\t\t});\n\n\t\t// ADDING DATA TO MAP\n\t\t\t// creating and compiling the template for our person objects\n\t\t\t    var submissionTemplate =  Handlebars.compile($(\"#submission\").html());\n\n\t\t\t\t$.getJSON('http://apps.dallasnews.com/livewire/memorials/approved', function(data) {\n\t\t\t\t\t$.each(data, function(k,v) {\n\t\t\t\t\t\tv.race = v.race.trim();\n\t\t\t\t\t\tv.location = v.location.trim();\n\t\t\t\t\t});\n\t\t\t\t\tsubmissionData = data;\n \t\t\t\t\twriteSubmissions(submissionData);\n\n\t\t\t        $.each(data, function(key, value) {\n\t\t\t            if (uniqArray.indexOf(value.location) === -1) {\n\t\t\t                uniqArray.push(value.location);\n\t\t\t            }\n\t\t\t        });\n\t\t\t\t\tconsole.log(uniqArray);\n\n\t\t\t\t\twriteLocations(uniqArray);\n\t\t\t\t\tswitchFilterHed();\n\n\t\t\t\t\tmap.on('load', function () {\n\t\t\t\t\t\tformatData(submissionData);\n\t\t\t\t\t});\n\n\n\n\t\t\t\t\t  jQuery(function(changeShadows) {\n\t\t\t\t\t \t $('.submissions').on('scroll', function() {\n\t\t\t\t\t \t\t if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight - 30) {\n\t\t\t\t\t \t\t\t $('#shadow-bottom').removeClass(\"shadow2\");\n\t\t\t\t\t \t\t } else if ($(this).scrollTop() + $(this).innerHeight() <= $(this)[0].scrollHeight) {\n\t\t\t\t\t \t\t\t $('#shadow-bottom').addClass(\"shadow2\");\n\t\t\t\t\t \t\t }\n\t\t\t\t\t \t });\n\t\t\t\t\t  });\n\n\t\t\t\t});\n\n\t\t\t\tfunction writeSubmissions(data) {\n\t\t\t\t\t$.each(data, function(k,v) {\n\t\t\t\t\t\t   var content = submissionTemplate(v);\n\t\t\t\t\t\t   $(\".submissions\").append(content);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction writeLocations(data) {\n\t\t\t\t\t$.each(data, function(k,v) {\n\t\t\t\t\t\t\tvar content = \"<li data-park='\" + v + \"'><a>\" + v + \"</a></li>\";\n\t\t\t\t\t\t\tvar mobileContent = \"<li data-park='\" + v + \"'>\" + v + \"</li>\";\n\t\t\t\t\t\t   $(\"li.drop-location > ul.dropmenu\").append(content);\n\t\t\t\t\t\t   $(\".filter-mob-expand ul:last-child\").append(mobileContent);\n\t\t\t\t\t\t   // hide filter expansion on li click\n\t\t\t\t\t});\n\t\t\t\t\t$('.filter-mob-expand ul li').click(function () {\n\t\t\t\t\t\t$('.filter-mob-expand').slideToggle();\n\t\t\t\t\t});\n\t\t\t\t\t// Getting the value of the location drop\n\t\t\t\t\t\t$('.drop-location li, .filter-mob-location li').click(function() {\n\t\t\t\t\t\t\tlocation = $(this).attr(\"data-park\");\n\t\t\t\t\t\t\tfilteringData(race, location);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tfunction formatData(data) {\n          console.log(data);\n\t\t\t\t\t// placeholder array for parks mapfeatureg data\n\t\t\t\t\tparks = [];\n\n\t\t\t\t\t// iterate over our original datra and create a new object to add to our parks mapfeatureg array\n\t\t\t\t\t$.each(data, function(k,v) {\n\n\t\t\t\t\t  var currentSub = {\n\t\t\t\t\t    \"location\": v.location,\n\t\t\t\t\t    \"lat\": v.lat,\n\t\t\t\t\t    \"long\": v.long,\n\t\t\t\t\t    \"races\": [ ],\n\t\t\t\t\t\t\"raceKey\": v.raceKey\n\t\t\t\t\t};\n\n\t\t\t\t\t  parks.push(currentSub);\n\t\t\t\t\t});\n\n\n\t\t\t\t\t// LODASH: go through our new parks mapfeatureg data, and filter out any that have a duplicate location\n\t\t\t\t\tparks = _.uniqBy(parks, \"location\");\n\n\t\t\t\t\t// iterate over the submissions data again and grab each one's park and race\n\t\t\t\t\t$.each(data, function(key, value) {\n\t\t\t\t\t  var currentPark = value.location;\n\t\t\t\t\t  var currentRace = value.race;\n\n\t\t\t\t\t  // then, iterate over the parks mapfeature data, and find the matching park\n\t\t\t\t\t  $.each(parks, function(k,v) {\n\t\t\t\t\t    if (currentPark === v.location) {\n\n\t\t\t\t\t      // then, check over the races array over that park, and if the currentRace isn't included, add it\n\t\t\t\t\t      if (_.indexOf(v.races, currentRace) === -1) {\n\t\t\t\t\t        v.races.push(currentRace);\n\t\t\t\t\t      }\n\t\t\t\t\t    }\n\t\t\t\t\t  });\n\t\t\t\t\t});\n\n\t\t\t\t\tcreateMap(parks);\n\n\t\t\t\t\t// adds cursor: pointer to map points\n\t\t\t\t\t\tmap.on('mousemove', function (e) {\n\t\t\t\t\t\t\tvar features = map.queryRenderedFeatures(e.point, { layers: ['memorialSubmissions'] });\n\t\t\t\t\t\t\tmap.getCanvas().style.cursor = (features.length) ? 'pointer' : '';\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\n\n\t\t\t\t// Map points customization\n\t\t\t\t\tfunction createMap(data) {\n\t\t\t\t\t\tdata = GeoJSON.parse(data, {Point: ['lat', 'long'], include: ['race', 'location', 'raceKey']});\n\n\t\t\t\t\t\t\t// adding the data source\n\t\t\t\t            map.addSource(\"memorials\", {\n\t\t\t\t                type: \"geojson\",\n\t\t\t\t                data: data\n\t\t\t\t            });\n\t\t\t\t            // adding the data layer\n\t\t\t\t            map.addLayer({\n\t\t\t\t                \"id\": \"memorialSubmissions\",\n\t\t\t\t                \"source\": \"memorials\",\n\t\t\t\t                \"type\": \"circle\",\n\t\t\t\t                \"paint\": {\n\t\t\t\t                    \"circle-radius\":\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t                        stops: [[1, 10], [8, 10], [16, 9]]\n\t\t\t\t                    },\n\t\t\t\t\t\t\t\t\t'circle-color': circleColor,\n\t\t\t\t\t\t\t\t\t\"circle-opacity\": 0.8\n\t\t\t\t                }\n\t\t\t\t            });\n\n\t\t\t\t\t}\n\n\t\t\t\t\tmap.on('click', function (e) {\n                        clickLocation = e.lngLat;\n                        coord = [clickLocation.lng, clickLocation.lat];\n\n                        // setting features equal to all the circles on the map\n                        var features = map.queryRenderedFeatures(e.point, { layers: ['memorialSubmissions'] });\n\n                        var popup;\n                        // checking to see if the click was on one of the circles.\n                        // if it's not, do all the code inside this if statement\n\n                        if (!features.length) {\n                            popup = new mapboxgl.Popup()\n                                .setLngLat(coord)\n\t\t\t\t\t\t\t\t.setHTML(\"<h5>\" + popupContentNoCir + \"</h5>\")\n                                .addTo(map);\n\t\t\t\t\t\t\t\tmap.flyTo({center: coord});\n                        }\n\n                        // else, if the click is on the circle, do all the code\n                        // inside this else statement\n                        else {\n                            var feature = features[0];\n\n                            // Populate the popup and set its coordinates\n                            // based on the feature found.\n                            popup = new mapboxgl.Popup()\n                                .setLngLat(feature.geometry.coordinates)\n\t\t\t\t\t\t\t\t.setHTML(\"<h5>\" + feature.properties.location + \"</h5>\" + popupContentCir)\n                                .addTo(map);\n\n\n\t\t\t\t\t\t\t\t$(\".submission-nav h1\").html(feature.properties.location);\n\n\t\t\t\t\t\t\tdisplaySubmissions(feature.properties.location);\n                        }\n\n\n\t\t\t\t\t\tif (features.length) {\n\t\t\t\t\t\t\t// Get coordinates from the symbol and center the map on those coordinates\n\t\t\t\t\t\t\tmap.flyTo({center: features[0].geometry.coordinates});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Shows/hides submission form and respective buttons\n\t\t\t\t\t\t// Adds value to textarea\n\n\t\t\t\t\t\t\t$('#form-wrapper').removeClass('visible');\n\n\t\t\t\t\t\t\t$(\".yes-btn-cir\").click(function() {\n\t\t\t\t\t\t\t\t$(\"#form-wrapper\").addClass(\"visible\");\n\t\t\t\t\t\t\t\t// $('#see-form, .map-wrapper h1').hide();\n\t\t\t\t\t\t\t\t$('.mapboxgl-popup').hide();\n\t\t\t\t\t\t\t\t$('.location-blank').val(feature.properties.location + coord);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t$(\".no-btn\").click(function() {\n\t\t\t\t\t\t\t\t$('.mapboxgl-popup').hide();\n\t\t\t\t\t\t\t\t$('#form-wrapper').removeClass('visible');\n\t\t\t\t\t\t\t\t$('textarea#location-blank').val('');\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t$(\".yes-btn-nocir\").click(function() {\n\t\t\t\t\t\t\t\t$(\"#form-wrapper\").addClass(\"visible\");\n\t\t\t\t\t\t\t\t// $('#see-form, .map-wrapper h1').hide();\n\t\t\t\t\t\t\t\t$('.mapboxgl-popup').hide();\n\t\t\t\t\t\t\t\t$('textarea#location-blank').val(coord);\n\t\t\t\t\t\t\t});\n                    });\n\n\t\t\t\t\t// Listen for the `geocoder.input` event that is triggered when a user\n\t\t\t\t    // makes a selection and add a symbol that matches the result.\n\t\t\t\t    geocoder.on('result', function(ev) {\n\n\t\t\t\t\t\t$('.mapboxgl-popup').hide();\n\n\t\t\t\t\t\tcenterCoord = ev.result.geometry.coordinates;\n                        var coord = [centerCoord[0], centerCoord[1]];\n\n                        var popup;\n\n                        popup = new mapboxgl.Popup()\n\t\t\t\t\t\t\t.setLngLat(coord)\n\t\t\t\t\t\t\t.setHTML(\"<h5>\" + popupContentNoCir + \"</h5>\")\n                            .addTo(map);\n\t\t\t\t\t\t\t// map.flyTo({center: coord});\n                        // }\n\n\t\t\t\t    });\n\n\t\t\t\t\t// Formatting the filteredData\n\t\t\t\t\tfunction filteringData(race, location) {\n\t\t\t\t\t\t// counter = 0;\n\n\t\t\t\t\t\tif (race !== \"all\" && location !== \"all\") {\n\t\t\t\t\t\t\tfilteredData = [];\n\t\t\t\t\t\t\t$.each(submissionData, function(k,v) {\n\t\t\t\t\t\t\t\tif (v.race === race && v.location === location) {\n\t\t\t\t\t\t\t\t\tfilteredData.push(v);\n\t\t\t\t\t\t\t\t\tcircleColor = v.color;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tclearMap();\n\t\t\t\t\t\t\tformatData(filteredData);\n\n\t\t\t\t\t\t\t$(\".submissions\").html(\"\");\n\n\t\t\t\t\t\t\tif (filteredData.length !== 0) {\n\t\t\t\t\t\t\t\twriteSubmissions(filteredData);\n\t\t\t\t\t\t\t\tdisplaySubmissions(location);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (race === \"all\" && location === \"all\") {\n\t\t\t\t\t\t\tclearMap();\n\t\t\t\t\t\t\tcircleColor = \"#8554bf\";\n\t\t\t\t\t\t\tformatData(submissionData);\n\t\t\t\t\t\t\twriteSubmissions(submissionData);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (race === \"all\" && location !== \"all\") {\n\t\t\t\t\t\t\tfilteredData = [];\n\t\t\t\t\t\t\t$.each(submissionData, function(k,v) {\n\t\t\t\t\t\t\t\tif (v.location === location) {\n\t\t\t\t\t\t\t\t\tfilteredData.push(v);\n\t\t\t\t\t\t\t\t\tcircleColor = \"#8554bf\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tclearMap();\n\t\t\t\t\t\t\tformatData(filteredData);\n\n\t\t\t\t\t\t\t$(\".submissions\").html(\"\");\n\n\t\t\t\t\t\t\tif (filteredData.length !== 0) {\n\t\t\t\t\t\t\t\twriteSubmissions(filteredData);\n\t\t\t\t\t\t\t\tdisplaySubmissions(location);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (location === \"all\" && race !== \"all\") {\n\t\t\t\t\t\t\tfilteredData = [];\n\t\t\t\t\t\t\t$.each(submissionData, function(k,v) {\n\t\t\t\t\t\t\t\tif (v.race === race) {\n\t\t\t\t\t\t\t\t\tfilteredData.push(v);\n\t\t\t\t\t\t\t\t\tcircleColor = \"#8554bf\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tclearMap();\n\t\t\t\t\t\t\tformatData(filteredData);\n\n\t\t\t\t\t\t\t$(\".submissions\").html(\"\");\n\n\t\t\t\t\t\t\tif (filteredData.length !== 0) {\n\t\t\t\t\t\t\t\twriteSubmissions(filteredData);\n\t\t\t\t\t\t\t\tdisplaySubmissions(location);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Clears the map of markers\n\t\t\t\t\tfunction clearMap() {\n\t\t\t\t\t\tmap.removeSource(\"memorials\");\n\t\t\t\t\t\tmap.removeLayer(\"memorialSubmissions\");\n\t\t\t\t\t}\n\n\t\t\t\t\t// Displays submissions\n\t\t\t\t\tfunction displaySubmissions(parkName) {\n\t\t\t\t\t\t$.each($(\".card\"), function() {\n\t\t\t\t\t\t\tif (parkName === \"all\" || $(this).attr(\"data-park\") === parkName) {\n\t\t\t\t\t\t\t\t$(this).removeClass(\"no-show\");\n\t\t\t\t\t\t\t\t$(this).addClass(\"exists\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$(this).addClass(\"no-show\");\n\t\t\t\t\t\t\t\t$(this).removeClass(\"exists\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// submits memorial submission to database\n\t\t\t\t\t// Flags as approved and saves to database\n\t\t\t\t    $('.submit').click(function() {\n\t\t\t\t\t\tvar subLong, subLat, subRace, raceKey;\n\t\t\t\t\t\tsubRace = $('#race-dropdown option:selected').text();\n\t\t\t\t\t\traceKey = $('#race-dropdown option:selected').index() - 1;\n\n\t\t\t\t\t\tvar valid = false;\n\n\t\t\t\t\t\t$.each($('.form-control'), function(index, elem) {\n\t\t\t\t\t\t\tif (!$(elem).val()) {\n\t\t\t\t\t\t\t\t$(elem).addClass('form-control-empty');\n\t\t\t\t\t\t\t\tvalid = false;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$(elem).removeClass('form-control-empty');\n\t\t\t\t\t\t\t\tvalid = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\t\tif (coord.length === 0) {\n\t\t\t\t\t\t\tsubLong = \"\";\n\t\t\t\t\t\t\tsubLat = \"\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsubLong = coord[0];\n\t\t\t\t\t\t\tsubLat = coord[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcolors = ['#e34e36', '#329ce8', '#ff8f24', '#52b033', '#fec44f', '#6dccf2'];\n\t\t\t\t        var submission = {\n\t\t\t\t            \"approved\": false,\n\t\t\t\t            \"firstName\": $('.first-blank').val(),\n\t\t\t\t            \"lastName\": $('.last-blank').val(),\n\t\t\t\t            \"email\": $('.email-blank').val(),\n\t\t\t\t            \"race\": subRace,\n\t\t\t\t\t\t\t\"raceKey\": raceKey,\n\t\t\t\t\t\t\t\"color\": colors[raceKey],\n\t\t\t\t            \"location\": $('.location-blank').val(),\n\t\t\t\t\t\t\t\"lat\": subLat,\n\t\t\t\t\t\t\t\"long\": subLong,\n\t\t\t\t            \"why\": $('.why-blank').val(),\n\t\t\t\t            \"learnMore\": $('.learn-blank').val()\n\t\t\t\t        };\n\t\t\t\t\t\tcoord = [];\n\n\t\t\t\t\t\tif (valid === true) {\n\t\t\t\t\t\t\tenterSubmission(submission);\n\t\t\t\t\t\t\t// Display modal after submission\n\t\t\t\t\t\t\t$('.form-group').hide();\n\t\t\t\t\t\t\t$('.form-horizontal h5').show();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tfunction enterSubmission(submission) {\n\t\t\t\t\t\t// send the report object to the database.\n\t\t\t\t\t\t$.post(\"http://apps.dallasnews.com/livewire/memorials/submission\", submission, function() {\n\t\t\t\t            console.log(\"Success!\");\n\t\t\t\t            // $(\"#post-response\").removeClass(\"no-show\");\n\t\t\t\t        }).fail(function() {\n\t\t\t\t            console.log(\"Whoops, something bad happened!\");\n\t\t\t\t        });\n\t\t\t\t\t}\n\n\t\t\t\t\t// show filter expansion on click\n\t\t\t\t\t$('.filter-mob').click(function () {\n\t\t\t\t\t\t$('.filter-mob-expand').slideToggle();\n\t\t\t\t\t});\n\n\t// injecting current year into footer\n\t// DO NOT DELETE\n\n\tvar d = new Date();\n\tvar year = d.getFullYear();\n\n\t$('.copyright').text(year);\n\n\n\t// some code blocks require javascript to function, like slideshows, synopsis blocks, etc\n\t// you can find that code here: https://github.com/DallasMorningNews/generator-dmninteractives/wiki/Cookbook\n\n\t// closes any header dropdown menus and resets the up/down chevron\n\tfunction closeList() {\n\t\t$(\".open-list\").removeClass(\"open-list\");\n\t\t$(\".open-button\").removeClass(\"open-button\");\n\t}\n\n\tvar $hedButton = $(\".header-group button\");\n\n\t// clicking any of the header dropdown menu buttons (i.e. \"topics\", or \"my account\")\n\t$hedButton.click(function(e) {\n\n\t\t// if the button that is clicked is already open, close the menu, else, close the\n\t\t// menu then open the selected menu\n\t\tif ($hedButton.hasClass(\"open-button\") === true && $(this).hasClass(\"open-button\") === true) {\n\t\t\tcloseList();\n\t\t} else {\n\t\t\tcloseList();\n\t\t\t$(this).addClass(\"open-button\");\n\t\t\t$(this).siblings(\"ul\").addClass(\"open-list\");\n\t\t}\n\t\te.stopPropagation();\n\t});\n\n\t// clicking anywhere in the body should close any open menus\n\t$(\"body\").click(function() {\n\t\tcloseList();\n\t});\n\n\t// if the user is signed in, add the subscribed class to the body, which will reveal\n\t// the proper my account menu items.\n\tif (document.cookie.indexOf(\"DMN-P\") >= 0) {\n\t\t$(\"body\").addClass(\"subscribed\");\n\t} else {\n\t\t$(\"body\").removeClass(\"subscribed\");\n\t}\n\n\n\t// some code blocks require javascript to function, like slideshows, synopsis blocks, etc\n\t// you can find that code here: https://github.com/DallasMorningNews/generator-dmninteractives/wiki/Cookbook\n\n\n\n});\n"]}