$(document).ready(function(){function e(e){$.each(e,function(e,o){var s=w(o);$(".submissions").append(s)})}function o(e){f=[],$.each(e,function(e,o){var s={location:o.location,lat:o.lat,"long":o["long"],races:[],raceKey:o.raceKey};f.push(s)}),f=_.uniqBy(f,"location"),$.each(e,function(e,o){var s=o.location,a=o.race;$.each(f,function(e,o){s===o.location&&_.indexOf(o.races,a)===-1&&o.races.push(a)})}),s(f),x.on("mousemove",function(e){var o=x.queryRenderedFeatures(e.point,{layers:["memorialSubmissions"]});x.getCanvas().style.cursor=o.length?"pointer":""})}function s(e){e=GeoJSON.parse(e,{Point:["lat","long"],include:["race","location","raceKey"]}),x.addSource("memorials",{type:"geojson",data:e}),x.addLayer({id:"memorialSubmissions",source:"memorials",type:"circle",paint:{"circle-radius":{stops:[[1,10],[8,10],[16,9]]},"circle-color":g,"circle-opacity":.8}})}function a(s){d=0,"all"!==s?(m=[],$.each(l,function(e,o){o.race===s&&(m.push(o),g=o.color)}),n(),o(m),$(".submissions").html(""),0===m.length?$(".submission-nav h1").html("No locations"):($(".submission-nav h1").html(m[d].location),e(m),t(m[d].location))):(n(),g="#e34e36",o(l),$(".submissions").html(""),$(".submission-nav h1").html("All locations"),e(l))}function n(){x.removeSource("memorials"),x.removeLayer("memorialSubmissions")}function t(e){$.each($(".card"),function(){$(this).attr("data-park")===e?($(this).removeClass("no-show"),$(this).addClass("exists")):($(this).addClass("no-show"),$(this).removeClass("exists"))})}function i(e){"sub-btn-prev"===e.attr("id")&&d>0?(d--,$("#sub-btn-prev").removeClass("unclickable")):"sub-btn-next"===e.attr("id")&&d<f.length-1&&(d++,$("#sub-btn-next").removeClass("unclickable")),"sub-btn-prev"===e.attr("id")&&d<=0?($("#sub-btn-prev").addClass("unclickable"),$("#sub-btn-next").removeClass("unclickable")):"sub-btn-next"==e.attr("id")&&d>=f.length-1?($("#sub-btn-next").addClass("unclickable"),$("#sub-btn-prev").removeClass("unclickable")):($("#sub-btn-prev").removeClass("unclickable"),$("#sub-btn-next").removeClass("unclickable")),"all"===v?($(".submission-nav h1").html(l[d].location),t(l[d].location)):($(".submission-nav h1").html(m[d].location),t(m[d].location))}var l,r,c,m=[],u=[],p="<p>Add a memorial suggestion here?</p><a class='yes-btn-cir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>",b="<p>Add a memorial suggestion here?</p><a class='yes-btn-nocir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>",h=new mapboxgl.Geocoder({container:"geocoder-container"}),d=0,f=[],v="all",g="#e34e36",y=0;$(".drop-menu li a").click(function(){$(".filter-btn:first-child").text($(this).text()),$(".filter-btn:first-child").val($(this).text()),$(".mapboxgl-popup").hide()}),mapboxgl.accessToken="pk.eyJ1IjoibWFjbWFuIiwiYSI6ImVEbmNmZjAifQ.zVzy9cyjNT1tMYOTex51HQ";var x=new mapboxgl.Map({container:"map",center:[-96.9785,32.8924],zoom:9,style:"mapbox://styles/mapbox/basic-v9"});x.scrollZoom.disable(),x.addControl(h),x.addControl(new mapboxgl.Navigation),x.on("mousemove",function(e){var o=x.queryRenderedFeatures(e.point,{layers:["memorialSubmissions"]});x.getCanvas().style.cursor=o.length?"pointer":""});var w=Handlebars.compile($("#submission").html());$.getJSON("js/data.json",function(s){l=s,e(l),x.on("load",function(){o(l)}),jQuery(function(e){$(".submissions").on("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight-30?$("#shadow-bottom").removeClass("shadow2"):$(this).scrollTop()+$(this).innerHeight()<=$(this)[0].scrollHeight&&$("#shadow-bottom").addClass("shadow2")})}),$(".sub-btn").click(function(){y=0,$(".exists").each(function(){y+=$(this).outerHeight(!0),console.log(y)}),console.log("final height:"+y),y<=$(".submissions").height()?$("#shadow-bottom").removeClass("shadow2"):$("#shadow-bottom").addClass("shadow2")})}),x.on("click",function(e){r=e.lngLat,u=[r.lng,r.lat];var o,s=x.queryRenderedFeatures(e.point,{layers:["memorialSubmissions"]});if(s.length){var a=s[0];o=(new mapboxgl.Popup).setLngLat(a.geometry.coordinates).setHTML("<h5>"+a.properties.location+"</h5>"+p).addTo(x),$(".submission-nav h1").html(a.properties.location),t(a.properties.location)}else o=(new mapboxgl.Popup).setLngLat(u).setHTML("<h5>"+b+"</h5>").addTo(x),x.flyTo({center:u});s.length&&x.flyTo({center:s[0].geometry.coordinates}),$("#form-wrapper").removeClass("visible"),$(".yes-btn-cir").click(function(){$("#form-wrapper").addClass("visible"),$("#see-form, .map-wrapper h1").hide(),$(".mapboxgl-popup").hide(),$("textarea#location-blank").val(a.properties.location+u)}),$(".no-btn").click(function(){$(".mapboxgl-popup").hide(),$("#form-wrapper").removeClass("visible"),$("textarea#location-blank").val("")}),$(".yes-btn-nocir").click(function(){$("#form-wrapper").addClass("visible"),$("#see-form, .map-wrapper h1").hide(),$(".mapboxgl-popup").hide(),$("textarea#location-blank").val(u)})}),h.on("result",function(e){$(".mapboxgl-popup").hide(),c=e.result.geometry.coordinates;var o,s=[c[0],c[1]];o=(new mapboxgl.Popup).setLngLat(s).setHTML("<h5>"+b+"</h5>").addTo(x)}),$("#see-form").on("mouseover",function(){$(".add-pin").show()}),$("#see-form, .map-wrapper h1").click(function(){$("#form-wrapper").addClass("visible"),$("#see-form, .map-wrapper h1").hide()}),$(".close").click(function(){$("#form-wrapper").removeClass("visible"),$("#see-form, .map-wrapper h1").show()}),$(".drop-menu li").click(function(){v=$(this).attr("data-race"),a(v)}),$(".sub-btn").click(function(){i($(this))});var C=new Date,k=C.getFullYear();$(".copyright").text(k)});
//# sourceMappingURL=scripts-bundle.js.map
