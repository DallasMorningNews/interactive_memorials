$(document).ready(function(){function o(o){$.each(o,function(o,e){var a=w(e);$(".submissions").append(a)})}function e(o){f=[],$.each(o,function(o,e){var a={location:e.location,lat:e.lat,"long":e["long"],races:[],raceKey:e.raceKey};f.push(a)}),f=_.uniqBy(f,"location"),$.each(o,function(o,e){var a=e.location,n=e.race;$.each(f,function(o,e){a===e.location&&_.indexOf(e.races,n)===-1&&e.races.push(n)})}),a(f),y.on("mousemove",function(o){var e=y.queryRenderedFeatures(o.point,{layers:["memorialSubmissions"]});y.getCanvas().style.cursor=e.length?"pointer":""})}function a(o){console.log(v),o=GeoJSON.parse(o,{Point:["lat","long"],include:["race","location","raceKey"]}),y.addSource("memorials",{type:"geojson",data:o}),y.addLayer({id:"memorialSubmissions",source:"memorials",type:"circle",paint:{"circle-radius":{stops:[[1,10],[8,10],[16,9]]},"circle-color":v,"circle-opacity":.8}})}function n(a){h=0,"all"!==a?(m=[],$.each(l,function(o,e){e.race===a&&(m.push(e),v=e.color)}),console.log(v),t(),e(m),$(".submissions").html(""),0===m.length?$(".submission-nav h1").html("No locations"):($(".submission-nav h1").html(m[h].location),o(m),i(m[h].location))):(t(),v="#fec44f",e(l),$(".submissions").html(""),$(".submission-nav h1").html("All locations"),o(l))}function t(){y.removeSource("memorials"),y.removeLayer("memorialSubmissions")}function i(o){$.each($(".submission-pv"),function(){$(this).attr("data-park")===o?$(this).removeClass("no-show"):$(this).addClass("no-show")})}function s(o){"sub-btn-prev"===o.attr("id")&&h>0?(h--,console.log("going back")):"sub-btn-next"===o.attr("id")&&h<f.length-1&&(h++,console.log("going forward")),console.log(l,h),"all"===g?($(".submission-nav h1").html(l[h].location),i(l[h].location)):($(".submission-nav h1").html(m[h].location),i(m[h].location))}var l,r,c,m=[],p=[],u="<p>Would you like to add a memorial suggestion here?</p><a class='yes-btn-cir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>",b="<p>Would you like to add a memorial suggestion here?</p><a class='yes-btn-nocir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>",d=new mapboxgl.Geocoder({container:"geocoder-container"}),h=0,f=[],g="all",v="#fec44f";$(".dropdown-menu li a").click(function(){$(".btn:first-child").text($(this).text()),$(".btn:first-child").val($(this).text())}),mapboxgl.accessToken="pk.eyJ1IjoibWFjbWFuIiwiYSI6ImVEbmNmZjAifQ.zVzy9cyjNT1tMYOTex51HQ";var y=new mapboxgl.Map({container:"map",center:[-96.9785,32.8924],zoom:9,style:"mapbox://styles/mapbox/basic-v9"});y.scrollZoom.disable(),y.addControl(d),y.addControl(new mapboxgl.Navigation),y.on("mousemove",function(o){var e=y.queryRenderedFeatures(o.point,{layers:["memorialSubmissions"]});y.getCanvas().style.cursor=e.length?"pointer":""});var w=Handlebars.compile($("#submission").html());$.getJSON("js/data.json",function(a){l=a,o(l),y.on("load",function(){e(l)})}),y.on("click",function(o){r=o.lngLat,p=[r.lng,r.lat];var e,a=y.queryRenderedFeatures(o.point,{layers:["memorialSubmissions"]});if(a.length){var n=a[0];e=(new mapboxgl.Popup).setLngLat(n.geometry.coordinates).setHTML("<h5>"+n.properties.location+"</h5>"+u).addTo(y)}else e=(new mapboxgl.Popup).setLngLat(p).setHTML("<h5>"+b+"</h5>").addTo(y),y.flyTo({center:p});a.length&&y.flyTo({center:a[0].geometry.coordinates}),$("#form-wrapper").removeClass("visible"),$(".yes-btn-cir").click(function(){$("#form-wrapper").addClass("visible"),$("#see-form, .map-wrapper h1").hide(),$(".mapboxgl-popup").hide(),$("textarea#location-blank").val(n.properties.location+p)}),$(".no-btn").click(function(){$(".mapboxgl-popup").hide(),$("#form-wrapper").removeClass("visible"),$("textarea#location-blank").val("")}),$(".yes-btn-nocir").click(function(){$("#form-wrapper").addClass("visible"),$("#see-form, .map-wrapper h1").hide(),$(".mapboxgl-popup").hide(),$("textarea#location-blank").val(p)})}),d.on("result",function(o){$(".mapboxgl-popup").hide(),c=o.result.geometry.coordinates;var e,a=[c[0],c[1]];e=(new mapboxgl.Popup).setLngLat(a).setHTML("<h5>"+b+"</h5>").addTo(y)}),$("#see-form, .map-wrapper h1").click(function(){$("#form-wrapper").addClass("visible"),$("#see-form, .map-wrapper h1").hide()}),$(".close").click(function(){$("#form-wrapper").removeClass("visible"),$("#see-form, .map-wrapper h1").show()}),$(".dropdown-menu li").click(function(){g=$(this).attr("data-race"),n(g)}),$(".sub-btn").click(function(){s($(this))});var x=new Date,k=x.getFullYear();$(".copyright").text(k)});
//# sourceMappingURL=scripts-bundle.js.map
