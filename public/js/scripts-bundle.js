$(document).ready(function(){function e(e){$.each(e,function(e,o){var a=b(o);$(".submissions").append(a)})}function o(e){var o=[];$.each(e,function(e,a){var n={location:a.location,lat:a.lat,"long":a["long"],races:[]};o.push(n)}),o=_.uniqBy(o,"location"),$.each(e,function(e,a){var n=a.location,t=a.race;$.each(o,function(e,o){n===o.location&&_.indexOf(o.races,t)===-1&&o.races.push(t)})}),a(o)}function a(e){e=GeoJSON.parse(e,{Point:["lat","long"],include:["race","location"]}),console.log(e),d.addSource("memorials",{type:"geojson",data:e}),d.addLayer({id:"memorialSubmissions",source:"memorials",type:"circle",paint:{"circle-radius":{stops:[[1,10],[8,10],[16,9]]},"circle-color":"#FBD44B","circle-opacity":{property:"opacity",stops:[[0,0],[1,1]]}}})}function n(e){"all"!==e?(l=[],$.each(r,function(o,a){a.race===e&&l.push(a)}),console.log(l),t(),o(l)):(t(),o(r))}function t(){console.log("Test"),d.off("click"),d.off("mousemove"),d.removeSource("memorials"),d.removeLayer("memorialSubmissions")}var r,i,s,l=[],c=[],p="<p>Would you like to add a memorial suggestion here?</p><a class='yes-btn-cir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>",m="<p>Would you like to add a memorial suggestion here?</p><a class='yes-btn-nocir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>",u=new mapboxgl.Geocoder({container:"geocoder-container"});$(".dropdown-menu li a").click(function(){$(".btn:first-child").text($(this).text()),$(".btn:first-child").val($(this).text())});var d=new mapboxgl.Map({container:"map",center:[-96.9785,32.8924],zoom:9,style:"http://maps.dallasnews.com/styles.json"});d.scrollZoom.disable(),d.addControl(u),mapboxgl.accessToken="pk.eyJ1IjoibWFjbWFuIiwiYSI6ImVEbmNmZjAifQ.zVzy9cyjNT1tMYOTex51HQ",d.addControl(new mapboxgl.Navigation),d.on("mousemove",function(e){var o=d.queryRenderedFeatures(e.point,{layers:["memorialSubmissions"]});d.getCanvas().style.cursor=o.length?"pointer":""});var b=Handlebars.compile($("#submission").html());$.getJSON("js/data.json",function(a){r=a,e(r),d.on("load",function(){o(r)})}),d.on("click",function(e){i=e.lngLat,c=[i.lng,i.lat];var o,a=d.queryRenderedFeatures(e.point,{layers:["memorialSubmissions"]});if(a.length){var n=a[0];o=(new mapboxgl.Popup).setLngLat(n.geometry.coordinates).setHTML("<h5>"+n.properties.location+"</h5>"+p).addTo(d)}else o=(new mapboxgl.Popup).setLngLat(c).setHTML("<h5>"+m+"</h5>").addTo(d),d.flyTo({center:c});a.length&&d.flyTo({center:a[0].geometry.coordinates}),$("#form-wrapper").removeClass("visible"),$(".yes-btn-cir").click(function(){$("#form-wrapper").addClass("visible"),$("#see-form, .map-wrapper h1").hide(),$(".mapboxgl-popup").hide(),$("textarea#location-blank").val(n.properties.location+c)}),$(".no-btn").click(function(){$(".mapboxgl-popup").hide(),$("#form-wrapper").removeClass("visible"),$("textarea#location-blank").val("")}),$(".yes-btn-nocir").click(function(){$("#form-wrapper").addClass("visible"),$("#see-form, .map-wrapper h1").hide(),$(".mapboxgl-popup").hide(),$("textarea#location-blank").val(c)})}),u.on("result",function(e){$(".mapboxgl-popup").hide(),s=e.result.geometry.coordinates;var o,a=[s[0],s[1]];o=(new mapboxgl.Popup).setLngLat(a).setHTML("<h5>"+m+"</h5>").addTo(d)}),$("#see-form, .map-wrapper h1").click(function(){$("#form-wrapper").addClass("visible"),$("#see-form, .map-wrapper h1").hide()}),$(".close").click(function(){$("#form-wrapper").removeClass("visible"),$("#see-form, .map-wrapper h1").show()}),$(".dropdown-menu li").click(function(){var e=$(this).attr("data-race");n(e)});var f=new Date,h=f.getFullYear();$(".copyright").text(h)});
//# sourceMappingURL=scripts-bundle.js.map
