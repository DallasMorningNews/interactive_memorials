$(document).ready(function(){function e(){$(".drop-location ul.dropmenu li a").click(function(){$(".location-hed").text($(this).text()),$(".location-hed:first-child").val($(this).text()),$(".mapboxgl-popup").hide()}),$(".drop-filter ul.dropmenu li a").click(function(){$(".filter-hed").text($(this).text()),$(".filter-hed:first-child").val($(this).text()),$(".mapboxgl-popup").hide()})}function o(e){$.each(e,function(e,o){var a=w(o);$(".submissions").append(a)})}function a(e){$.each(e,function(e,o){var a="<li data-park='"+o+"'><a>"+o+"</a></li>";$("li.drop-location > ul.dropmenu").append(a)})}function n(e){g=[],$.each(e,function(e,o){var a={location:o.location,lat:o.lat,"long":o["long"],races:[],raceKey:o.raceKey};g.push(a)}),g=_.uniqBy(g,"location"),$.each(e,function(e,o){var a=o.location,n=o.race;$.each(g,function(e,o){a===o.location&&_.indexOf(o.races,n)===-1&&o.races.push(n)})}),i(g),k.on("mousemove",function(e){var o=k.queryRenderedFeatures(e.point,{layers:["memorialSubmissions"]});k.getCanvas().style.cursor=o.length?"pointer":""})}function i(e){e=GeoJSON.parse(e,{Point:["lat","long"],include:["race","location","raceKey"]}),k.addSource("memorials",{type:"geojson",data:e}),k.addLayer({id:"memorialSubmissions",source:"memorials",type:"circle",paint:{"circle-radius":{stops:[[1,10],[8,10],[16,9]]},"circle-color":x,"circle-opacity":.8}})}function t(e){v=0,"all"!==e?(u=[],$.each(r,function(o,a){a.race===e&&(u.push(a),x=a.color)}),s(),n(u),$(".submissions").html(""),0===u.length?($(".submission-nav h1").html("No locations"),$("#sub-btn-prev").addClass("unclickable"),$("#sub-btn-next").addClass("unclickable")):($(".submission-nav h1").html(u[v].location),o(u),l(u[v].location),$("#sub-btn-prev").removeClass("unclickable"),$("#sub-btn-next").removeClass("unclickable"),changeParks($(".sub-btn")))):(s(),x="#8554bf",n(r),$("#sub-btn-prev").removeClass("unclickable"),$("#sub-btn-next").removeClass("unclickable"),changeParks($(".sub-btn")),$(".submissions").html(""),$(".submission-nav h1").html("All locations"),o(r))}function s(){k.removeSource("memorials"),k.removeLayer("memorialSubmissions")}function l(e){$.each($(".card"),function(){$(this).attr("data-park")===e?($(this).removeClass("no-show"),$(this).addClass("exists")):($(this).addClass("no-show"),$(this).removeClass("exists"))})}var r,c,p,u=[],m=[],d=[],b="<p>Add a memorial suggestion here?</p><a class='yes-btn-cir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>",h="<p>Add a memorial suggestion here?</p><a class='yes-btn-nocir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>",f=new mapboxgl.Geocoder({container:"geocoder-container"}),v=0,g=[],y="all",x="#8554bf";$(".filter").click(function(e){e.stopPropagation(),$(this).closest(".filter").siblings(".filter").find("ul.dropmenu:visible").slideToggle(),$(this).find("ul.dropmenu").slideToggle()}),$(document).click(function(){$(".drop-filter > ul.dropmenu").hide(),$(".drop-location > ul.dropmenu").hide()}),mapboxgl.accessToken="pk.eyJ1IjoibWFjbWFuIiwiYSI6ImVEbmNmZjAifQ.zVzy9cyjNT1tMYOTex51HQ";var k=new mapboxgl.Map({container:"map",center:[-96.9785,32.8924],zoom:9,style:"mapbox://styles/mapbox/basic-v9"});k.scrollZoom.disable(),k.addControl(f),k.addControl(new mapboxgl.Navigation),k.on("mousemove",function(e){var o=k.queryRenderedFeatures(e.point,{layers:["memorialSubmissions"]});k.getCanvas().style.cursor=o.length?"pointer":""});var w=Handlebars.compile($("#submission").html());$.getJSON("http://apps.dallasnews.com/livewire/memorials/approved",function(i){r=i,o(r),e(),$.each(i,function(e,o){m.indexOf(o.location)===-1&&m.push(o.location)}),console.log(m),a(m),k.on("load",function(){n(r)}),jQuery(function(e){$(".submissions").on("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight-30?$("#shadow-bottom").removeClass("shadow2"):$(this).scrollTop()+$(this).innerHeight()<=$(this)[0].scrollHeight&&$("#shadow-bottom").addClass("shadow2")})})}),k.on("click",function(e){c=e.lngLat,d=[c.lng,c.lat];var o,a=k.queryRenderedFeatures(e.point,{layers:["memorialSubmissions"]});if(a.length){var n=a[0];o=(new mapboxgl.Popup).setLngLat(n.geometry.coordinates).setHTML("<h5>"+n.properties.location+"</h5>"+b).addTo(k),$(".submission-nav h1").html(n.properties.location),l(n.properties.location)}else o=(new mapboxgl.Popup).setLngLat(d).setHTML("<h5>"+h+"</h5>").addTo(k),k.flyTo({center:d});a.length&&k.flyTo({center:a[0].geometry.coordinates}),$("#form-wrapper").removeClass("visible"),$(".yes-btn-cir").click(function(){$("#form-wrapper").addClass("visible"),$(".mapboxgl-popup").hide(),$("textarea#location-blank").val(n.properties.location+d)}),$(".no-btn").click(function(){$(".mapboxgl-popup").hide(),$("#form-wrapper").removeClass("visible"),$("textarea#location-blank").val("")}),$(".yes-btn-nocir").click(function(){$("#form-wrapper").addClass("visible"),$(".mapboxgl-popup").hide(),$("textarea#location-blank").val(d)})}),f.on("result",function(e){$(".mapboxgl-popup").hide(),p=e.result.geometry.coordinates;var o,a=[p[0],p[1]];o=(new mapboxgl.Popup).setLngLat(a).setHTML("<h5>"+h+"</h5>").addTo(k)}),$(".add-pin, .map-wrapper h1").click(function(){$("#form-wrapper").hasClass("visible")?$("#form-wrapper").removeClass("visible"):$("#form-wrapper").addClass("visible")}),$(".close").click(function(){$("#form-wrapper").removeClass("visible")}),$(".dropmenu li").click(function(){y=$(this).attr("data-race"),t(y)});var C=new Date,T=C.getFullYear();$(".copyright").text(T)});
//# sourceMappingURL=scripts-bundle.js.map
