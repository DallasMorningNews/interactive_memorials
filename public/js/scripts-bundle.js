$(document).ready(function(){function o(){$(".drop-location ul.dropmenu li a").click(function(){$(".location-hed").text($(this).text()),$(".location-hed:first-child").val($(this).text()),$(".mapboxgl-popup").hide()}),$(".drop-filter ul.dropmenu li a").click(function(){$(".filter-hed").text($(this).text()),$(".filter-hed:first-child").val($(this).text()),$(".mapboxgl-popup").hide()}),$(".filter-mob-expand li").click(function(){$(".mapboxgl-popup").hide()})}function e(o){$.each(o,function(o,e){var a=H(e);$(".submissions").append(a)})}function a(o){$.each(o,function(o,e){var a="<li data-park='"+e+"'><a>"+e+"</a></li>",i="<li data-park='"+e+"'>"+e+"</li>";$("li.drop-location > ul.dropmenu").append(a),$(".filter-mob-expand ul:last-child").append(i)}),$(".filter-mob-expand ul li").click(function(){$(".filter-mob-expand").slideToggle()}),$(".drop-location li, .filter-mob-location li").click(function(){w=$(this).attr("data-park"),l(x,w)})}function i(o){console.log(o),y=[],$.each(o,function(o,e){var a={location:e.location,lat:e.lat,"long":e["long"],races:[],raceKey:e.raceKey};y.push(a)}),y=_.uniqBy(y,"location"),$.each(o,function(o,e){var a=e.location,i=e.race;$.each(y,function(o,e){a===e.location&&_.indexOf(e.races,i)===-1&&e.races.push(i)})}),n(y),L.on("mousemove",function(o){var e=L.queryRenderedFeatures(o.point,{layers:["memorialSubmissions"]});L.getCanvas().style.cursor=e.length?"pointer":""})}function n(o){o=GeoJSON.parse(o,{Point:["lat","long"],include:["race","location","raceKey"]}),L.addSource("memorials",{type:"geojson",data:o}),L.addLayer({id:"memorialSubmissions",source:"memorials",type:"circle",paint:{"circle-radius":{stops:[[1,10],[8,10],[16,9]]},"circle-color":k,"circle-opacity":.8}})}function l(o,a){"all"!==o&&"all"!==a&&(u=[],$.each(p,function(e,i){i.race===o&&i.location===a&&(u.push(i),k=i.color)}),t(),i(u),$(".submissions").html(""),0!==u.length&&(e(u),s(a))),"all"===o&&"all"===a&&(t(),k="#8554bf",i(p),e(p)),"all"===o&&"all"!==a&&(u=[],$.each(p,function(o,e){e.location===a&&(u.push(e),k="#8554bf")}),t(),i(u),$(".submissions").html(""),0!==u.length&&(e(u),s(a))),"all"===a&&"all"!==o&&(u=[],$.each(p,function(e,a){a.race===o&&(u.push(a),k=a.color)}),t(),i(u),$(".submissions").html(""),0!==u.length&&(e(u),s(a)))}function t(){L.removeSource("memorials"),L.removeLayer("memorialSubmissions")}function s(o){$.each($(".card"),function(){"all"===o||$(this).attr("data-park")===o?($(this).removeClass("no-show"),$(this).addClass("exists")):($(this).addClass("no-show"),$(this).removeClass("exists"))})}function r(o){$.post("http://apps.dallasnews.com/livewire/memorials/submission",o,function(){console.log("Success!")}).fail(function(){console.log("Whoops, something bad happened!")})}function c(){$(".open-list").removeClass("open-list"),$(".open-button").removeClass("open-button")}var p,d,m,u=[],h=[],f=[],b="<p>Add a place here?</p><a class='yes-btn-cir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>",g="<p>Add a place here?</p><a class='yes-btn-nocir btn btn-primary btn-sm'>Yes</a><a class='no-btn btn btn-default btn-sm'>No</a>",v=new mapboxgl.Geocoder({container:"geocoder-container"}),y=[],x="all",k="#8554bf",w="all",C=["#e34e36","#329ce8","#ff8f24","#52b033","#fec44f","#6dccf2","#323232"],T=["Black or African Am.","Asian","Hispanic or Latino","Am. Indian","Native Hawaiian","LGBT","Other"];$(".filter").click(function(o){o.stopPropagation(),$(this).closest(".filter").siblings(".filter").find("ul.dropmenu:visible").slideToggle(),$(this).find("ul.dropmenu").slideToggle()}),$(document).click(function(){$(".drop-filter > ul.dropmenu").hide(),$(".drop-location > ul.dropmenu").hide()}),$(".add-pin, .map-wrapper h1").click(function(){$("#form-wrapper").hasClass("visible")?$("#form-wrapper").removeClass("visible"):$("#form-wrapper").addClass("visible")}),$(".close, .modal-close").click(function(){$("#form-wrapper").removeClass("visible"),$(".modal").hide(),$(".form-control").val(""),$(".form-group").show(),$(".form-horizontal h5").hide()}),$(".add-pin, .map-wrapper").click(function(){$(".modal").hide(),$(".form-control").val(""),$(".form-group").show(),$(".form-horizontal h5").hide()}),$(".drop-filter li, .filter-mob-race li").click(function(){x=$(this).attr("data-race"),l(x,w)}),mapboxgl.accessToken="pk.eyJ1IjoibWFjbWFuIiwiYSI6ImVEbmNmZjAifQ.zVzy9cyjNT1tMYOTex51HQ";var L=new mapboxgl.Map({container:"map",center:[-96.9785,32.8924],zoom:9,style:"mapbox://styles/mapbox/basic-v9"});L.scrollZoom.disable(),L.addControl(v),L.addControl(new mapboxgl.Navigation),L.on("mousemove",function(o){var e=L.queryRenderedFeatures(o.point,{layers:["memorialSubmissions"]});L.getCanvas().style.cursor=e.length?"pointer":""});var H=Handlebars.compile($("#submission").html());$.getJSON("http://apps.dallasnews.com/livewire/memorials/approved",function(n){$.each(n,function(o,e){e.race=e.race.trim(),e.location=e.location.trim();var a=T.indexOf(e.race),i=C[a];e.raceKey=a,e.color=i}),p=n,e(p),$.each(n,function(o,e){h.indexOf(e.location)===-1&&h.push(e.location)}),console.log(h),a(h),o(),L.on("load",function(){i(p)}),jQuery(function(o){$(".submissions").on("scroll",function(){$(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight-30?$("#shadow-bottom").removeClass("shadow2"):$(this).scrollTop()+$(this).innerHeight()<=$(this)[0].scrollHeight&&$("#shadow-bottom").addClass("shadow2")})})}),L.on("click",function(o){d=o.lngLat,f=[d.lng,d.lat];var e,a=L.queryRenderedFeatures(o.point,{layers:["memorialSubmissions"]});if(a.length){var i=a[0];e=(new mapboxgl.Popup).setLngLat(i.geometry.coordinates).setHTML("<h5>"+i.properties.location+"</h5>"+b).addTo(L),$(".submission-nav h1").html(i.properties.location),s(i.properties.location)}else e=(new mapboxgl.Popup).setLngLat(f).setHTML("<h5>"+g+"</h5>").addTo(L),L.flyTo({center:f});a.length&&L.flyTo({center:a[0].geometry.coordinates}),$("#form-wrapper").removeClass("visible"),$(".yes-btn-cir").click(function(){$("#form-wrapper").addClass("visible"),$(".mapboxgl-popup").hide(),$(".location-blank").val(i.properties.location+f)}),$(".no-btn").click(function(){$(".mapboxgl-popup").hide(),$("#form-wrapper").removeClass("visible"),$("textarea#location-blank").val("")}),$(".yes-btn-nocir").click(function(){$("#form-wrapper").addClass("visible"),$(".mapboxgl-popup").hide(),$("textarea#location-blank").val(f)})}),v.on("result",function(o){$(".mapboxgl-popup").hide(),m=o.result.geometry.coordinates;var e,a=[m[0],m[1]];e=(new mapboxgl.Popup).setLngLat(a).setHTML("<h5>"+g+"</h5>").addTo(L)}),$(".submit").click(function(){var o,e,a,i;a=$("#race-dropdown option:selected").text(),i=$("#race-dropdown option:selected").index()-1;var n=!1;$.each($(".form-control"),function(o,e){$(e).val()?($(e).removeClass("form-control-empty"),n=!0):($(e).addClass("form-control-empty"),n=!1)}),0===f.length?(o="",e=""):(o=f[0],e=f[1]);var l={approved:!1,firstName:$(".first-blank").val(),lastName:$(".last-blank").val(),email:$(".email-blank").val(),race:a,raceKey:i,color:color,location:$(".location-blank").val(),lat:e,"long":o,why:$(".why-blank").val(),learnMore:$(".learn-blank").val()};f=[],n===!0&&(r(l),$(".form-group").hide(),$(".form-horizontal h5").show())}),$(".filter-mob").click(function(){$(".filter-mob-expand").slideToggle()});var N=new Date,S=N.getFullYear();$(".copyright").text(S);var O=$(".header-group button");O.click(function(o){O.hasClass("open-button")===!0&&$(this).hasClass("open-button")===!0?c():(c(),$(this).addClass("open-button"),$(this).siblings("ul").addClass("open-list")),o.stopPropagation()}),$("body").click(function(){c()}),document.cookie.indexOf("DMN-P")>=0?$("body").addClass("subscribed"):$("body").removeClass("subscribed")});
//# sourceMappingURL=scripts-bundle.js.map
